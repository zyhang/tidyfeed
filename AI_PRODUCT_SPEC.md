# Project Context: TidyFeed
> **SYSTEM ROLE:** You are a Senior Full-Stack Engineer and Product Architect. This document is the SINGLE SOURCE OF TRUTH for the TidyFeed project. Refer to this whenever you plan, write, or refactor code.

## 1. Product Manifesto
**Name:** TidyFeed
**Type:** Chrome Extension (Manifest V3) + SaaS Web Dashboard
**Mission:** Filter social media noise, capture valuable content, and turn it into a structured knowledge base using AI.
**Target Audience:** US/EU Market (English-first), Knowledge Workers, Researchers.

## 2. Tech Stack & Constraints (STRICT)
### 2.1 Extension (Client-Side)
- **Framework:** WXT (wxt.dev) - *Must use for extension scaffolding.*
- **UI Library:** React + TailwindCSS + Shadcn UI.
- **State Management:** Zustand (for local preferences).
- **Storage:** `chrome.storage.local` (User prefs), IndexedDB (Offline cache).
- **Target Platforms:** Chromium (Chrome, Edge, Brave), Firefox.

### 2.2 Web Dashboard (Cloud-Side)
- **Framework:** React + Vite.
- **Hosting:** Cloudflare Pages.
- **Styling:** TailwindCSS + Framer Motion (Bento-grid style).
- **Auth:** Supabase Auth (Google OAuth).
- **Database:** Supabase (PostgreSQL).
- **AI Engine:** DeepSeek V3 API (via Proxy or direct client-side if key provided).

## 3. Architecture Overview
The project consists of two distinct parts that communicate:
1.  **The Extension (Collector):** Injects into DOM, filters content, scrapes data.
2.  **The Dashboard (Brain):** Manages saved content, performs AI analysis, syncs across devices.

## 4. Feature Specifications

### 4.1 Feature: Noise Filter (Extension)
* **Logic:** content_script injects into `twitter.com`, `x.com`.
* **Action:** Detects promoted tweets and ads using DOM observation (e.g., specific SVG paths, text indicators).
* **Behavior:** Automatically hides ad elements and updates a "Blocked Ads" counter in the sidebar.
* **Status:** ✅ Implemented (Ad Blocker active).

### 4.2 Feature: Media Clipper (Extension)
* **Trigger:** "Download" button injected into the Tweet action bar.
* **Data Capture:**
    * **Main Tweet:** Text, Media (Images/Videos), Metadata.
    * **Quote Tweet:** Full support for extracting Quote Tweet text and media (including videos).
    * **Tech:** Robust fallback to Syndication API for video extraction and metadata when DOM is insufficient.
* **Output:** ZIP file with structured folders (`main/`, `quote/`) and smart naming (`handle_tweetId_type_index.ext`).
* **Status:** ✅ Implemented (Robust Quote Tweet support added).

### 4.3 Feature: AI Second Brain (Dashboard)
* **Input:** Text from saved posts.
* **Process:** Send to DeepSeek API with prompt: "Summarize key insights, extract code snippets, and tag topics."
* **Output:** Structured JSON stored in DB (`summary`, `tags`, `sentiment`).

## 5. Data Schema (Supabase/PostgreSQL)
*Use this schema for all backend operations.*

```sql
-- Users Table
create table public.users (
  id uuid references auth.users not null,
  email text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- Saved Items (Clips)
create table public.items (
  id uuid default uuid_generate_v4() primary key,
  user_id uuid references public.users,
  source_platform text check (source_platform in ('twitter', 'reddit', 'tiktok')),
  source_url text,
  author_handle text,
  content_text text, -- Full raw text
  media_urls jsonb, -- Array of image/video URLs
  ai_summary text, -- Generated by DeepSeek
  tags text[], -- Array of AI-generated tags
  is_archived boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now())
);
```

## 6. Coding Rules (The "Vibe Coding" Style)
Don't Ask, Just Do (carefully): If a file structure is obvious based on WXT patterns, implement it. Only ask if there's a major architectural conflict.
Type Safety: Always use TypeScript interfaces. No any unless absolutely necessary.
Component Modularity: Small, reusable components. Put UI components in /components/ui (Shadcn style).
Error Handling:
Extension: If DOM selector fails (Twitter changed layout), fail silently and log to debug console. Do NOT crash the page.
Dashboard: Show Toast notifications for API errors.
Privacy First: Never log user content or API keys to the server logs.

## 7. Immediate Roadmap (MVP)
[x] Phase 1: Setup WXT + Tailwind + Manifest V3.
[x] Phase 2: Implement "Ad Hiding" on X.com (DOM injection).
[x] Phase 3: Implement "Download Media" button on X.com.
    [x] Basic Image/Text Download.
    [x] Video Download (Syndication API).
    [x] Quote Tweet Support (Media + Text + Video Fallback).
[ ] Phase 4: Setup Supabase Auth & DB connection.
[ ] Phase 5: Integrate DeepSeek API for summarization.
